<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Check-in Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #FF4500 0%, #FF6600 25%, #FF8C00 50%, #FFA500 75%, #FFB347 100%);
            color: white;
            padding: 20px;
            min-height: 100vh;
        }

        .dashboard {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            color: #333;
        }

        .logo-container {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100px;
        }

        .logo {
            max-height: 100px;
            max-width: 300px;
            width: auto;
            height: auto;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }

        .event-title {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #FF4500;
            font-weight: bold;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 15px;
        }

        .stat-box {
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #FF6600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #FF4500;
        }

        .stat-label {
            font-size: 0.9em;
            color: #333;
            font-weight: 600;
        }

        .checkin-list {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .list-header {
            font-size: 1.5em;
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #FF6600;
            color: #FF4500;
            font-weight: bold;
        }

        .checkin-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            margin: 8px 0;
            background: white;
            border-radius: 10px;
            transition: all 0.3s ease;
            border-left: 4px solid #FF6600;
            border: 2px solid #FFB347;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            color: #333;
        }

        .checkin-item.newest {
            background: #FFF8DC;
            border-left: 4px solid #FF4500;
            border: 2px solid #FF4500;
            box-shadow: 0 0 20px rgba(255, 69, 0, 0.4);
            transform: scale(1.02);
            animation: shake 0.5s ease-in-out, newItemGlow 5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0) scale(1.02); }
            25% { transform: translateX(-5px) scale(1.02); }
            75% { transform: translateX(5px) scale(1.02); }
        }

        @keyframes newItemGlow {
            0%, 100% { 
                background: #FFF8DC;
                box-shadow: 0 0 20px rgba(255, 69, 0, 0.4);
            }
            50% { 
                background: #FFEBCD;
                box-shadow: 0 0 30px rgba(255, 69, 0, 0.6);
            }
        }

        .person-info {
            flex: 1;
        }

        .person-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 3px;
            color: #333;
        }

        .person-details {
            font-size: 0.9em;
            color: #666;
        }

        .ticket-info {
            text-align: right;
            flex-shrink: 0;
        }

        .ticket-number {
            font-size: 1.4em;
            font-weight: bold;
            color: #FF4500;
            margin-bottom: 3px;
        }

        .checkin-time {
            font-size: 0.8em;
            color: #888;
        }

        .new-badge {
            background: #FF4500;
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.7em;
            font-weight: bold;
            animation: pulse 1s infinite;
            margin-left: 10px;
            box-shadow: 0 2px 10px rgba(255, 69, 0, 0.5);
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 2px 10px rgba(255, 69, 0, 0.5); }
            50% { transform: scale(1.1); box-shadow: 0 4px 20px rgba(255, 69, 0, 0.8); }
            100% { transform: scale(1); box-shadow: 0 2px 10px rgba(255, 69, 0, 0.5); }
        }

        .no-checkins {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.2em;
            font-weight: 600;
        }

        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.8em;
            font-weight: bold;
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .connected {
            background: rgba(76, 175, 80, 0.9);
            color: white;
        }

        .disconnected {
            background: rgba(244, 67, 54, 0.9);
            color: white;
        }

        .loading {
            background: rgba(255, 152, 0, 0.9);
            color: white;
        }

        .debug-info {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 0.8em;
            border: 2px solid #FF6600;
            color: #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .debug-info strong {
            color: #FF4500;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .stats {
                flex-direction: column;
                gap: 15px;
            }
            
            .event-title {
                font-size: 1.8em;
            }
            
            .logo {
                max-height: 80px;
            }
            
            .checkin-item {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .ticket-info {
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <div class="logo-container">
                <!-- Try multiple possible logo file names -->
                <img class="logo" id="logoImage" alt="JooyMedia Logo" style="display: none;">
            </div>
            <h1 class="event-title">Lead The Future Conference 2025</h1>
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-number" id="checkedInCount">0</div>
                    <div class="stat-label">Checked In</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">200</div>
                    <div class="stat-label">Total Expected</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="percentageCount">0%</div>
                    <div class="stat-label">Progress</div>
                </div>
            </div>
        </div>

        <div class="checkin-list">
            <h2 class="list-header">üìã Recent Check-ins (Latest First)</h2>
            <div id="checkinItems">
                <div class="no-checkins">
                    Loading check-in data from GitHub... üîÑ
                </div>
            </div>
        </div>

        <!-- Debug information -->
        <div class="debug-info" id="debugInfo">
            <strong>üîç DETAILED DEBUG INFO:</strong><br>
            Status: Initializing...<br>
            Last fetch: Never<br>
            Total checkins: 0<br>
            Displaying last: 0 entries<br>
            Data source: GitHub JSON<br>
            Logo status: Checking...
        </div>
    </div>

    <div class="connection-status loading" id="connectionStatus">
        üü° Loading...
    </div>

    <script>
        // GitHub JSON URL for your checkins data
        const GITHUB_JSON_URL = 'https://api.github.com/repos/YeeSheng6726/LTFC2025-Checkin_dashboard/contents/data/checkins.json';
        
        let isFirstLoad = true;
        let fetchAttempts = 0;
        let lastDataCount = 0;

        // Logo loading function with multiple attempts
        function loadLogo() {
            const logoImg = document.getElementById('logoImage');
            const possibleNames = [
                'JooyMedia_logo.png',
                'JooyMedia-logo.png', 
                'jooy-media-logo.png',
                'logo.png',
                'JooyMedia.png'
            ];
            
            let attemptIndex = 0;
            
            function tryNextLogo() {
                if (attemptIndex >= possibleNames.length) {
                    updateDebugInfo('Logo: All attempts failed', [], null, 'Logo loading failed');
                    return;
                }
                
                const logoUrl = possibleNames[attemptIndex];
                logoImg.src = logoUrl;
                logoImg.onload = function() {
                    logoImg.style.display = 'block';
                    updateDebugInfo('Logo: ‚úÖ Loaded successfully (' + logoUrl + ')', [], null, 'Logo loaded');
                };
                logoImg.onerror = function() {
                    attemptIndex++;
                    setTimeout(tryNextLogo, 100);
                };
                
                updateDebugInfo('Logo: Trying ' + logoUrl, [], null, 'Attempting logo load');
            }
            
            tryNextLogo();
        }

        function updateDebugInfo(status, dataArray = [], error = null, extraInfo = '') {
            const debugElement = document.getElementById('debugInfo');
            const now = new Date().toLocaleTimeString();
            const dataCount = dataArray.length;
            
            // Show the actual order from data
            let dataOrder = 'Not loaded';
            if (dataArray.length > 0) {
                dataOrder = dataArray.map((person, index) => `${index + 1}. ${person.nricFullName || 'Unknown'}`).join(', ');
                if (dataOrder.length > 100) {
                    dataOrder = dataOrder.substring(0, 100) + '...';
                }
            }
            
            debugElement.innerHTML = `
                <strong>üîç DETAILED DEBUG INFO:</strong><br>
                Status: ${status}<br>
                Last fetch: ${now}<br>
                Total checkins: ${dataCount}<br>
                Displaying last: ${Math.min(5, dataCount)} entries<br>
                Data order: ${dataOrder}<br>
                Fetch attempts: ${fetchAttempts}<br>
                ${extraInfo ? `Extra: ${extraInfo}<br>` : ''}
                ${error ? `‚ùå Error: ${error}<br>` : ''}
                Data source: GitHub JSON
            `;
        }

        function formatTimeAgo(checkinTime) {
            try {
                const checkinDate = new Date(checkinTime);
                const now = new Date();
                const diffMinutes = Math.floor((now - checkinDate) / (1000 * 60));
                
                if (diffMinutes < 1) return 'just now';
                if (diffMinutes < 60) return `${diffMinutes} min ago`;
                
                const diffHours = Math.floor(diffMinutes / 60);
                if (diffHours < 24) return `${diffHours}h ago`;
                
                const diffDays = Math.floor(diffHours / 24);
                return `${diffDays}d ago`;
            } catch (error) {
                return checkinTime || 'Unknown time';
            }
        }

        function updateStats(checkedInCount) {
            document.getElementById('checkedInCount').textContent = checkedInCount;
            const percentage = Math.round((checkedInCount / 200) * 100);
            document.getElementById('percentageCount').textContent = `${percentage}%`;
        }

        function createCheckinItem(person, isNewest = false) {
            const item = document.createElement('div');
            item.className = `checkin-item ${isNewest ? 'newest' : ''}`;
            
            // Clean up ticket display - remove # if present
            let ticketDisplay = person.ticketID || person.ticketNumber || 'N/A';
            if (ticketDisplay.startsWith('#')) {
                ticketDisplay = ticketDisplay.substring(1);
            }
            
            item.innerHTML = `
                <div class="person-info">
                    <div class="person-name">${person.nricFullName || 'Unknown Name'}</div>
                    <div class="person-details">Ticket: ${person.ticketNumber || 'N/A'}</div>
                </div>
                <div class="ticket-info">
                    <div class="ticket-number">${ticketDisplay}</div>
                    <div class="checkin-time">${formatTimeAgo(person.checkinTime)}</div>
                </div>
                ${isNewest ? '<span class="new-badge">NEW!</span>' : ''}
            `;
            
            return item;
        }

        function updateCheckinDisplay(data) {
            const container = document.getElementById('checkinItems');
            
            if (data.length === 0) {
                container.innerHTML = '<div class="no-checkins">No check-ins yet... Waiting for data from GitHub üìä</div>';
                updateStats(0);
                return;
            }

            console.log('üîç DEBUGGING DATA ORDER:');
            console.log('Original data from GitHub:', data);
            
            // Take EXACTLY the last 5 entries from the data
            // These represent the most recent check-ins
            const lastFiveEntries = data.slice(-5);
            
            console.log('Last 5 entries:', lastFiveEntries);
            
            // Reverse the array so the NEWEST appears FIRST on dashboard
            const displayOrder = [...lastFiveEntries].reverse();
            
            console.log('Display order (reversed for newest first):', displayOrder);
            
            // Check if we have new data
            const hasNewEntry = data.length > lastDataCount;
            lastDataCount = data.length;
            
            // Clear container
            container.innerHTML = '';
            
            // Add items in display order (newest first)
            displayOrder.forEach((person, index) => {
                const isNewest = hasNewEntry && index === 0 && !isFirstLoad;
                const item = createCheckinItem(person, isNewest);
                container.appendChild(item);
            });
            
            // Remove NEW badge after 5 seconds
            if (hasNewEntry && !isFirstLoad) {
                setTimeout(() => {
                    const newestItem = container.querySelector('.checkin-item.newest');
                    if (newestItem) {
                        newestItem.classList.remove('newest');
                        const badge = newestItem.querySelector('.new-badge');
                        if (badge) badge.remove();
                    }
                }, 5000);
            }
            
            updateStats(data.length);
            isFirstLoad = false;
        }

        async function fetchGitHubData() {
    fetchAttempts++;
    
            try {
                updateDebugInfo('üîÑ Fetching from GitHub API...', [], null, 'Making request...');
                
                // Add cache busting to prevent stale data
                const response = await fetch(GITHUB_JSON_URL + '?v=' + Date.now());
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const apiResponse = await response.json();
                
                // Decode the base64 content from GitHub API
                const jsonData = JSON.parse(Buffer.from(apiResponse.content, 'base64').toString());
                
                if (!jsonData || !jsonData.checkins) {
                    throw new Error('Invalid JSON structure from GitHub');
                }
                
                console.log('üìÑ Raw JSON data received:', jsonData);
                
                const checkins = jsonData.checkins || [];
                
                console.log('‚úÖ Final parsed data:', checkins);
                
                updateCheckinDisplay(checkins);
                updateDebugInfo('‚úÖ Successfully loaded data via API', checkins, null, `Found ${checkins.length} check-ins, Total: ${jsonData.totalCheckins}, last updated: ${jsonData.lastUpdated}`);
                
                document.getElementById('connectionStatus').className = 'connection-status connected';
                document.getElementById('connectionStatus').innerHTML = 'üü¢ API Connected';
                
            } catch (error) {
                console.error('‚ùå Error fetching data:', error);
                updateDebugInfo('‚ùå API Connection failed', [], error.message, 'Check network/URL');
                
                document.getElementById('connectionStatus').className = 'connection-status disconnected';
                document.getElementById('connectionStatus').innerHTML = 'üî¥ API Error';
                
                if (isFirstLoad) {
                    document.getElementById('checkinItems').innerHTML = `
                        <div class="no-checkins">
                            ‚ùå Unable to connect to GitHub API<br>
                            <small>Error: ${error.message}</small>
                        </div>
                    `;
                }
            }
        }

        // Load logo when page loads
        loadLogo();
        
        // Initial data load
        fetchGitHubData();
        
        // Update every 5 seconds for real-time updates
        setInterval(fetchGitHubData, 5000);
    </script>
</body>
</html>
